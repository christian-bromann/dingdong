const AWS = require('aws-sdk')

AWS.config.region = 'eu-west-1'
const sns = new AWS.SNS()

const MESSAGE = 'Someone is at the door. Open up!!!'
const SUBJECT = 'SOUNDBURN X AWK SCL Rooftop Party'
const ERROR_RESPONSE = `<h1 style="color: red">Uups, something went wrong! Please post in the FB event, thanks!</h1>`
const SUCCESS_RESPONSE = `
<meta name="viewport" content="width=device-width, initial-scale=0.7, maximum-scale=1">
<style>
#msg,article{position:absolute;left:50%;top:40%;-moz-transform:translate(-50%,-50%);-ms-transform:translate(-50%,-50%);-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}html{background:#000}.candybox2{font-weight:700}.candybox2 span:nth-child(13n+1){-moz-animation:candy linear .5s infinite forwards -38.46ms;-webkit-animation:candy linear .5s infinite forwards -38.46ms;animation:candy linear .5s infinite forwards -38.46ms}.candybox2 span:nth-child(13n+2){-moz-animation:candy linear .5s infinite forwards -76.92ms;-webkit-animation:candy linear .5s infinite forwards -76.92ms;animation:candy linear .5s infinite forwards -76.92ms}.candybox2 span:nth-child(13n+3){-moz-animation:candy linear .5s infinite forwards -.11538s;-webkit-animation:candy linear .5s infinite forwards -.11538s;animation:candy linear .5s infinite forwards -.11538s}.candybox2 span:nth-child(13n+4){-moz-animation:candy linear .5s infinite forwards -.15385s;-webkit-animation:candy linear .5s infinite forwards -.15385s;animation:candy linear .5s infinite forwards -.15385s}.candybox2 span:nth-child(13n+5){-moz-animation:candy linear .5s infinite forwards -.19231s;-webkit-animation:candy linear .5s infinite forwards -.19231s;animation:candy linear .5s infinite forwards -.19231s}.candybox2 span:nth-child(13n+6){-moz-animation:candy linear .5s infinite forwards -.23077s;-webkit-animation:candy linear .5s infinite forwards -.23077s;animation:candy linear .5s infinite forwards -.23077s}.candybox2 span:nth-child(13n+7){-moz-animation:candy linear .5s infinite forwards -.26923s;-webkit-animation:candy linear .5s infinite forwards -.26923s;animation:candy linear .5s infinite forwards -.26923s}.candybox2 span:nth-child(13n+8){-moz-animation:candy linear .5s infinite forwards -.30769s;-webkit-animation:candy linear .5s infinite forwards -.30769s;animation:candy linear .5s infinite forwards -.30769s}.candybox2 span:nth-child(13n+9){-moz-animation:candy linear .5s infinite forwards -.34615s;-webkit-animation:candy linear .5s infinite forwards -.34615s;animation:candy linear .5s infinite forwards -.34615s}.candybox2 span:nth-child(13n+10){-moz-animation:candy linear .5s infinite forwards -.38462s;-webkit-animation:candy linear .5s infinite forwards -.38462s;animation:candy linear .5s infinite forwards -.38462s}.candybox2 span:nth-child(13n+11){-moz-animation:candy linear .5s infinite forwards -.42308s;-webkit-animation:candy linear .5s infinite forwards -.42308s;animation:candy linear .5s infinite forwards -.42308s}.candybox2 span:nth-child(13n+12){-moz-animation:candy linear .5s infinite forwards -.46154s;-webkit-animation:candy linear .5s infinite forwards -.46154s;animation:candy linear .5s infinite forwards -.46154s}.candybox2 span:nth-child(13n+13){-moz-animation:candy linear .5s infinite forwards -.5s;-webkit-animation:candy linear .5s infinite forwards -.5s;animation:candy linear .5s infinite forwards -.5s}@-moz-keyframes candy{0%{color:#208e4e;text-shadow:.1em 0 .1em #2ecc71,.15em 0 .1em #2ecc71}7.69231%{color:#19703e;text-shadow:.1em 0 .1em #27ae60,.15em 0 .1em #27ae60}15.38462%{color:#aa8a0a;text-shadow:.1em 0 .1em #f1c40f,.15em 0 .1em #f1c40f}23.07692%{color:#b06f09;text-shadow:.1em 0 .1em #f39c12,.15em 0 .1em #f39c12}30.76923%{color:#1d6fa5;text-shadow:.1em 0 .1em #3498db,.15em 0 .1em #3498db}38.46154%{color:#1b557a;text-shadow:.1em 0 .1em #2980b9,.15em 0 .1em #2980b9}46.15385%{color:#bf2718;text-shadow:.1em 0 .1em #e74c3c,.15em 0 .1em #e74c3c}53.84615%{color:#81261d;text-shadow:.1em 0 .1em #c0392b,.15em 0 .1em #c0392b}61.53846%{color:#713b87;text-shadow:.1em 0 .1em #9b59b6,.15em 0 .1em #9b59b6}69.23077%{color:#612e76;text-shadow:.1em 0 .1em #8e44ad,.15em 0 .1em #8e44ad}76.92308%{color:#117964;text-shadow:.1em 0 .1em #1abc9c,.15em 0 .1em #1abc9c}84.61538%{color:#0d5d4d;text-shadow:.1em 0 .1em #16a085,.15em 0 .1em #16a085}92.30769%{color:rgba(217,217,217,.5);text-shadow:.1em 0 .1em rgba(255,255,255,.5),.15em 0 .1em rgba(255,255,255,.5)}100%{color:#208e4e;text-shadow:.1em 0 .1em #2ecc71,.15em 0 .1em #2ecc71}}@-webkit-keyframes candy{0%{color:#208e4e;text-shadow:.1em 0 .1em #2ecc71,.15em 0 .1em #2ecc71}7.69231%{color:#19703e;text-shadow:.1em 0 .1em #27ae60,.15em 0 .1em #27ae60}15.38462%{color:#aa8a0a;text-shadow:.1em 0 .1em #f1c40f,.15em 0 .1em #f1c40f}23.07692%{color:#b06f09;text-shadow:.1em 0 .1em #f39c12,.15em 0 .1em #f39c12}30.76923%{color:#1d6fa5;text-shadow:.1em 0 .1em #3498db,.15em 0 .1em #3498db}38.46154%{color:#1b557a;text-shadow:.1em 0 .1em #2980b9,.15em 0 .1em #2980b9}46.15385%{color:#bf2718;text-shadow:.1em 0 .1em #e74c3c,.15em 0 .1em #e74c3c}53.84615%{color:#81261d;text-shadow:.1em 0 .1em #c0392b,.15em 0 .1em #c0392b}61.53846%{color:#713b87;text-shadow:.1em 0 .1em #9b59b6,.15em 0 .1em #9b59b6}69.23077%{color:#612e76;text-shadow:.1em 0 .1em #8e44ad,.15em 0 .1em #8e44ad}76.92308%{color:#117964;text-shadow:.1em 0 .1em #1abc9c,.15em 0 .1em #1abc9c}84.61538%{color:#0d5d4d;text-shadow:.1em 0 .1em #16a085,.15em 0 .1em #16a085}92.30769%{color:rgba(217,217,217,.5);text-shadow:.1em 0 .1em rgba(255,255,255,.5),.15em 0 .1em rgba(255,255,255,.5)}100%{color:#208e4e;text-shadow:.1em 0 .1em #2ecc71,.15em 0 .1em #2ecc71}}@keyframes candy{0%{color:#208e4e;text-shadow:.1em 0 .1em #2ecc71,.15em 0 .1em #2ecc71}7.69231%{color:#19703e;text-shadow:.1em 0 .1em #27ae60,.15em 0 .1em #27ae60}15.38462%{color:#aa8a0a;text-shadow:.1em 0 .1em #f1c40f,.15em 0 .1em #f1c40f}23.07692%{color:#b06f09;text-shadow:.1em 0 .1em #f39c12,.15em 0 .1em #f39c12}30.76923%{color:#1d6fa5;text-shadow:.1em 0 .1em #3498db,.15em 0 .1em #3498db}38.46154%{color:#1b557a;text-shadow:.1em 0 .1em #2980b9,.15em 0 .1em #2980b9}46.15385%{color:#bf2718;text-shadow:.1em 0 .1em #e74c3c,.15em 0 .1em #e74c3c}53.84615%{color:#81261d;text-shadow:.1em 0 .1em #c0392b,.15em 0 .1em #c0392b}61.53846%{color:#713b87;text-shadow:.1em 0 .1em #9b59b6,.15em 0 .1em #9b59b6}69.23077%{color:#612e76;text-shadow:.1em 0 .1em #8e44ad,.15em 0 .1em #8e44ad}76.92308%{color:#117964;text-shadow:.1em 0 .1em #1abc9c,.15em 0 .1em #1abc9c}84.61538%{color:#0d5d4d;text-shadow:.1em 0 .1em #16a085,.15em 0 .1em #16a085}92.30769%{color:rgba(217,217,217,.5);text-shadow:.1em 0 .1em rgba(255,255,255,.5),.15em 0 .1em rgba(255,255,255,.5)}100%{color:#208e4e;text-shadow:.1em 0 .1em #2ecc71,.15em 0 .1em #2ecc71}}#msg{color:#fff;margin-top:150px;font-family:monospace;text-align:center;width:90%}
</style>
<article><pre class="candybox2"></pre></article>
<h1 id="msg">Someone is on the way. If no one shows up, post in the FB event, thanks!</h1>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
(function($){function injector(t,splitter,klass,after){var a=t.text().split(splitter),inject='';if(a.length){$(a).each(function(i,item){inject+='<span class="'+klass+(i+1)+'">'+item+'</span>'+after});t.empty().append(inject)}}var methods={init:function(){return this.each(function(){injector($(this),'','char','')})},words:function(){return this.each(function(){injector($(this),' ','word',' ')})},lines:function(){return this.each(function(){var r="eefec303079ad17405c889e092e105b0";injector($(this).children("br").replaceWith(r).end(),r,'line','')})}};$.fn.lettering=function(method){if(method&&methods[method]){return methods[method].apply(this,[].slice.call(arguments,1))}else if(method==='letters'||!method){return methods.init.apply(this,[].slice.call(arguments,0))}$.error('Method '+method+' does not exist on jQuery.lettering');return this}})(jQuery);
var text = "ICBfX19fX18gIF9fICAgICAgX18gIF9fICBfXyAgICAgIF9fX18gICAgX19fXyAgICAgX18gICAgICAgIAogL1wgIF8gIFwvXCBcICBfXy9cIFwvXCBcL1wgXCAgICAvXCAgX2BcIC9cICBfYFwgIC9cIFwgICAgICAgCiBcIFwgXExcIFwgXCBcL1wgXCBcIFwgXCBcLycvJyAgIFwgXCxcTFxfXCBcIFwvXF9cXCBcIFwgICAgICAKICBcIFwgIF9fIFwgXCBcIFwgXCBcIFwgXCAsICZsdDsgICAgIFwvX1xfXyBcXCBcIFwvXy9fXCBcIFwgIF9fIAogICBcIFwgXC9cIFwgXCBcXy8gXF9cIFwgXCBcXGBcICAgICAvXCBcTFwgXCBcIFxMXCBcXCBcIFxMXCBcCiAgICBcIFxfXCBcX1wgYFxfX194X19fL1wgXF9cIFxfXCAgIFwgYFxfX19fXCBcX19fXy8gXCBcX19fXy8KICAgICBcL18vXC9fLydcL19fLy9fXy8gIFwvXy9cL18vICAgIFwvX19fX18vXC9fX18vICAgXC9fX18vIAo="
$(".candybox2").html(atob(text))
$(".candybox2").lettering();
</script>`

const params = {
    PhoneNumber: '+49XXX',
    Message: MESSAGE,
    MessageStructure: 'string'
}

module.exports.message = (event, context, callback) => {
    sns.publish(params, (err, data) => callback(null, {
      statusCode: 200,
      headers: { 'content-type': 'text/html; charset=UTF-8' },
      body: err ? ERROR_RESPONSE + err.stack : SUCCESS_RESPONSE
    }))
};
